# INSTRUCTIONS FOR BUILDING THE Bit::Vector CFM68K SHARED LIBRARY
	


# (1) Copy the Bit-Vector-6.0 folder from the expanded Bit-Vector-6.0.tar.gz archive into the 
#     :MacPerl_Src:perl:ext folder of the MacPerl source distribution.
#  
#     and then
#
#     Set the current directory to the Bit-Vector-6.0 folder (via Directory menu).


# (2) Build the BitVector.o object file (with support for shared library model): 

SC BitVector.c -o BitVector.o  -sym off -w off  -model cfmflat -d CFM68K






# (3) Set the MPW variable 'MPSrc' to the path to your MacPerl_Src folder, for example     

Set MPSrc "MacintoshHD:MacPerl_Src"     # (change the path accordingly)




# (4) Run the XSUBpp compiler for Vector_68K.xs

perl :::lib:ExtUtils:xsubpp -typemap :::lib:ExtUtils:typemap -typemap :typemap  Vector_68K.xs >Vector.tc && Rename -y Vector.tc Vector.c






# (5) If you like, take a look at the resulting C source file Vector.c

open Vector.c





# (6) Compile Vector.c (with support for shared library model):


SC -w off -d __STD_C -d MULTIPLICITY ¶
	-d MPW_HAS_BOOL ¶
	-model cfmflat ¶
	-i {MPSrc}: ¶
	-i {MPSrc}:sfio:include: ¶
	-i {MPSrc}:GUSI:include: ¶
	-i {MPSrc}:perl: ¶
	-i : ¶
    -o Vector.c.o Vector.c




# (7) Link Vector.c.o as shared lib. Link against the BitVector.o object file from step (2)


ILink ¶
	":Vector.c.o" ¶
	BitVector.o ¶
	"{CFM68KLibraries}NuMathLib.o" ¶
	"{SharedLibraries}StdCLib" ¶
	"{SharedLibraries}InterfaceLib" ¶
	"{CFM68KLibraries}NuMacRuntime.o" ¶
	"{CFM68KLibraries}NuToolLibs.o" ¶
	{MPSrc}:perl:PerlStub ¶
	-sym off ¶
	-mf -d ¶
	-model cfmflat ¶
	-xm sharedlibrary ¶
	-fragname Vector ¶
	-export boot_Bit__Vector ¶
	-state rewrite ¶
	-compact -pad 0 ¶
	-o Vector.shlb.CFM68K




# (8) Rename shared lib temporary

Rename -y Vector.shlb.CFM68K Vector.shlb.CFM68K.tmp




# (9) Flatten the segmented shared library created by ILink

MakeFlat Vector.shlb.CFM68K.tmp -o Vector.shlb.CFM68K

 



# (10) Set the file type and creator of Vector.shlb.CFM68K 

SetFile -t 'shlb' -c 'cfmg' Vector.shlb.CFM68K




# (11) Delete the temporary file

Delete -y Vector.shlb.CFM68K.tmp



# (12) Rename the shared library 'Vector.shlb.CFM68K' to 'Vector'

Rename -y Vector.shlb.CFM68K Vector






#  Done. The shared library 'Vector' must be installed in the ':site_perl:MacCFM68K:auto:Bit:Vector' folder.

